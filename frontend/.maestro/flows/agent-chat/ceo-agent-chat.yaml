# Test: CEO Agent Chat Interaction
appId: com.autoadmin.app

---
# Initial setup and navigation
- runFlow:
    file: ../utils/helpers.yaml
    args:
      message: "Starting CEO Agent Chat Test"

- tapOn:
    text: "Chat"
    label: "Navigate to Chat tab"

- runFlow:
    file: ../../utils/helpers.yaml
    args:
      message: "Waiting for agent initialization"

# Wait for agent chat interface to load
- waitFor:
    id: "agent-chat-interface"
    timeout: 10000

# Check that CEO agent is selected by default
- assertVisible:
    text: "CEO"

---
# Test 1: Quick Action - Status Update
- tapOn:
    text: "Status Update"
    label: "Tap quick action for status update"

# Wait for message to be sent and response
- runFlow:
    file: ../../utils/helpers.yaml
    args:
      message: "Sent status update request"

- waitFor:
    text: "status"
    regex: true
    timeout: 45000

# Assert response contains key elements
- assertVisible:
    text: "operations"
    regex: true

- assertVisible:
    text: "performance"
    regex: true

---
# Test 2: Custom Message to CEO Agent
- tapOn:
    id: "chat-input"
    label: "Focus on chat input"

- inputText: "What are our top priorities for this quarter?"

- tapOn:
    text: "Send"
    label: "Send custom message"

# Wait for streaming response
- runFlow:
    file: ../../utils/helpers.yaml
    args:
      message: "Waiting for CEO response"

- waitFor:
    text: "priorities"
    timeout: 45000

# Assert response quality
- assertVisible:
    text: "quarter"
    regex: true

- assertVisible:
    text: "strategic"
    regex: true

---
# Test 3: Verify Message History
- scrollUntilVisible:
    element:
      text: "Status Update"
    direction: UP
    timeout: 5000

# Assert both messages are in history
- assertVisible:
    text: "Status Update"

- assertVisible:
    text: "top priorities"

---
# Test 4: Test Agent Switching
- tapOn:
    id: "agent-selector"
    label: "Open agent selector"

- tapOn:
    text: "Strategy"
    label: "Switch to Strategy Agent"

# Verify agent switched
- assertVisible:
    text: "Strategy Agent"

# Send message to Strategy agent
- tapOn:
    id: "chat-input"
    label: "Focus input for Strategy agent"

- inputText: "Analyze our competitive position in the market"

- tapOn:
    text: "Send"
    label: "Send to Strategy agent"

- waitFor:
    text: "competitive"
    timeout: 45000

- assertVisible:
    text: "market"
    regex: true

---
# Test 5: Clear Conversation
- longPressOn:
    text: "Clear"

- tapOn:
    text: "Clear"
    label: "Confirm clear conversation"

# Verify conversation is cleared
- assertNotVisible:
    text: "Status Update"

- runFlow:
    file: ../../utils/helpers.yaml
    args:
      message: "CEO Agent Chat Test Completed Successfully"