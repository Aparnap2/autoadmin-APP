# Test: Task Creation and Delegation
appId: com.autoadmin.app

---
# Setup
- runFlow:
    file: ../utils/helpers.yaml
    args:
      message: "Starting Task Creation Test"

- tapOn:
    text: "Explore"
    label: "Navigate to Task Manager tab"

- waitFor:
    testID: "task-manager-screen"
    timeout: 10000

---
# Test 1: Verify Task Manager UI
- assertVisible:
    testID: "task-manager-header"
    text: "Task Manager"

- assertVisible:
    testID: "fab-create-task"

- assertVisible:
    text: "Tasks"
    regex: true

---
# Test 2: Create New Task
- tapOn:
    testID: "fab-create-task"
    label: "Tap FAB to create task"

# Wait for task creator modal
- waitFor:
    text: "Create Task"
    timeout: 5000

---
# Test 3: Fill Task Details
# Enter task title
- tapOn:
    id: "task-title-input"
    label: "Tap title input"

- inputText: "Analyze Q4 Marketing Campaign Performance"

# Enter task description
- tapOn:
    id: "task-description-input"
    label: "Tap description input"

- inputText: "Review all marketing campaigns from Q4, analyze ROI, and provide recommendations for Q1 2025"

# Select agent type
- tapOn:
    id: "agent-type-selector"
    label: "Tap agent selector"

- tapOn:
    text: "Marketing Agent"
    label: "Select Marketing Agent"

# Select task type
- tapOn:
    id: "task-type-selector"
    label: "Tap task type selector"

- tapOn:
    text: "Analysis"
    label: "Select Analysis task type"

# Set priority
- tapOn:
    id: "priority-selector"
    label: "Tap priority selector"

- tapOn:
    text: "High"
    label: "Select High priority"

---
# Test 4: Create the Task
- tapOn:
    text: "Create Task"
    label: "Confirm task creation"

# Wait for task to be created
- waitFor:
    text: "Task created successfully"
    timeout: 15000

# Dismiss success message
- tapOn:
    text: "OK"
    label: "Dismiss success message"

---
# Test 5: Verify Task in List
- scrollUntilVisible:
    element:
      text: "Q4 Marketing Campaign"
    direction: DOWN
    timeout: 5000

- assertVisible:
    text: "Marketing Agent"

- assertVisible:
    text: "High"

- assertVisible:
    text: "Pending"
    regex: true

---
# Test 6: Check Task Details
- tapOn:
    text: "Q4 Marketing Campaign Performance"
    label: "Open task details"

# Wait for task detail view
- waitFor:
    text: "Task Details"
    timeout: 5000

# Verify all task information
- assertVisible:
    text: "Analyze ROI"
    regex: true

- assertVisible:
    text: "Marketing Agent"

- assertVisible:
    text: "Analysis"

- assertVisible:
    text: "High Priority"

# Check status indicators
- assertVisible:
    text: "Status:"
    regex: true

- assertVisible:
    text: "Created:"
    regex: true

---
# Test 7: Create Another Task for Different Agent
- tapOn:
    text: "Close"
    label: "Close task details"

- tapOn:
    testID: "fab-create-task"
    label: "Create another task"

# Fill new task details
- tapOn:
    id: "task-title-input"
    label: "Tap title input"

- inputText: "System Performance Optimization"

- tapOn:
    id: "task-description-input"
    label: "Tap description input"

- inputText: "Identify performance bottlenecks and optimize system response times"

- tapOn:
    id: "agent-type-selector"
    label: "Tap agent selector"

- tapOn:
    text: "DevOps Agent"
    label: "Select DevOps Agent"

- tapOn:
    id: "task-type-selector"
    label: "Tap task type selector"

- tapOn:
    text: "Optimization"
    label: "Select Optimization task type"

- tapOn:
    id: "priority-selector"
    label: "Tap priority selector"

- tapOn:
    text: "Medium"
    label: "Select Medium priority"

- tapOn:
    text: "Create Task"
    label: "Create DevOps task"

- waitFor:
    text: "Task created successfully"
    timeout: 15000

- tapOn:
    text: "OK"
    label: "Dismiss success message"

---
# Test 8: Verify Multiple Tasks
- scrollUntilVisible:
    element:
      text: "System Performance"
    direction: DOWN
    timeout: 5000

# Verify both tasks exist
- assertVisible:
    text: "Q4 Marketing"

- assertVisible:
    text: "System Performance"

# Verify different agents assigned
- assertVisible:
    text: "Marketing Agent"

- assertVisible:
    text: "DevOps Agent"

---
# Test 9: Test Task Filters
- tapOn:
    text: "Filter"
    label: "Open task filters"

- tapOn:
    text: "Marketing"
    label: "Filter by Marketing Agent"

# Wait for filter to apply
- waitFor:
    text: "Q4 Marketing"
    timeout: 5000

- assertNotVisible:
    text: "System Performance"

# Clear filters
- tapOn:
    text: "Clear Filters"
    label: "Clear all filters"

- runFlow:
    file: ../../utils/helpers.yaml
    args:
      message: "Task Creation Test Completed Successfully"