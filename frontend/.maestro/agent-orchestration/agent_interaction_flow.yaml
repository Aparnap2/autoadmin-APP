# Maestro Flow: Agent Orchestration via HTTP-only Communication
# Tests HTTP-based agent coordination without WebSockets

appId: host.exp.Exponent

tags:
  - critical
  - agent-workflow
  - http-communication
  - orchestration

---
# 1. Navigate to Agent Dashboard
- launchApp
- tapOn:
    id: "agents-tab"
- assertVisible: "Agent Dashboard"

# 2. Verify agent status loading (lazy loading)
- assertVisible: "Loading agent status..."
- waitFor:
    text: "Agents ready"
    timeout: 10000

# 3. Test HTTP-based agent status monitoring
- assertVisible: "Marketing Agent"
- assertVisible:
    text: "Idle"
    id: "marketing-agent-status"

# 4. Trigger agent task via HTTP
- tapOn:
    id: "trigger-marketing-agent"
- inputText: "Analyze competitor landscape"
- tapOn:
    id: "submit-task"

# 5. Verify HTTP task delegation
- assertVisible: "Task submitted"
- assertVisible: "Delegating to marketing_agent..."

# 6. Monitor real-time task progress via SSE
- waitFor:
    text: "Task in progress"
    timeout: 15000
- assertVisible:
    text: "marketing_agent"
    id: "task-agent"

# 7. Test task completion flow
- waitFor:
    text: "Task completed"
    timeout: 30000
- assertVisible: "Analysis complete"
- tapOn:
    id: "view-results"

# 8. Verify result display
- assertVisible: "Competitor Analysis"
- assertVisible: "Market insights generated"

# 9. Test multi-agent coordination
- tapOn: "Back"
- tapOn:
    id: "orchestrate-workflow"
- selectAgent:
    agent-1: "marketing_agent"
    agent-2: "research_agent"
- tapOn:
    id: "start-workflow"

# 10. Monitor coordinated execution
- assertVisible: "Workflow started"
- waitFor:
    text: "Research complete"
    timeout: 20000
- waitFor:
    text: "Marketing analysis complete"
    timeout: 30000

# 11. Verify HTTP-only communication indicators
- assertVisible:
    text: "HTTP Protocol"
    id: "communication-protocol"
- assertNotVisible:
    text: "WebSocket"
    id: "protocol-indicator"

# 12. Test error handling and recovery
- tapOn:
    id: "simulate-agent-error"
- assertVisible: "Agent execution failed"
- assertVisible: "Retrying with fallback..."
- waitFor:
    text: "Task completed"
    timeout: 15000

# 13. Performance validation
- assertVisible:
    text: "< 2s"
    id: "task-completion-time"
- assertVisible:
    text: "100%"
    id: "success-rate"